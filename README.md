# SmartWeatherMini
## Цель проекта

- Энергоэффективная модульная домашняя метеостанция на Wemos D1 mini (ESP8266).
- Пробуждение каждые N минут (настройка в веб-интерфейсе).
- Автоопределение подключённых датчиков (I²C / 1-Wire / аналог).
- Отправка показаний на сервер (MQTT или бинарным UDP-протоколом).
- Проверка OTA обновлений еженедельно (и обновление прошивки).
- Питание от батареи — цель: месяцы/годы работы (оптимизация deep sleep).
- Интерфейс для настройки (локальная Wi-Fi точка + web), интеграция с Home Assistant (MQTT Discovery рекомендован).

## Ключевые модули прошивки

- Core: управление wake/sleep, RTC counters, watchdog.
- Config: LittleFS конфиг файл key=value, web настройки.
- Sensors: автопоиск (I²C scan), подключение драйверов (по адресам/пинам).
- Network: Wi-Fi connect, MQTT client, UDP binary sender, HTTP client для OTA.
- OTA: проверка версии, загрузка .bin, откат/проверки.
- UI: Web server (режим конфигурации) + простая страница с настройками.
- Storage: LittleFS (файлы, HTML/ресурсы), RTC_DATA_ATTR для счётчиков пробуждений.

## Энергосбережение

- Wi-Fi включать только на время отправки данных/OTA.
- Перед deep sleep: Wi-Fi off, TCP cleanup, датчики в powerDown (если поддерживают).
- Использовать глубокий сон: ESP.deepSleep(microseconds).
- Минимизировать использование RAM, не использовать String, избегать динамического выделения.

## Оптимизации

- Убрать логи/Serial в релизе.
- Отключать исключения/RTTI (PlatformIO build_flags).
- Минимизировать использование тяжёлых библиотек (заменить ArduinoJson и пр.).
- Компрессия страниц, хранение в SPIFFS gzip.

